<section class="on-{{ navigation.activeView }}" ng-controller="EventController as eventCtrl">
    <div>
        <header>
            <i ng-click="navigation.toggleMenu()" class="left icon-menu"></i>
            <div ng-switch on="eventCtrl.status.isLoading">
                <div ng-switch-when="true">
                    <i class="right icon-spin color-blue animate-spin"></i>
                </div>
                <div ng-switch-default>
                    <i ng-click="eventCtrl.toggleFilters()" class="right icon-filter color-blue"></i>
                </div>
            </div>
            <h1 class="title">{{ 'events'|translate }}</h1>
        </header>
        <div ng-if="eventCtrl.status.isDone && eventCtrl.status.isError" class="error">
            <p ng-click="eventCtrl.refresh()">
                <i class="right icon-spin"></i>
                {{ 'error.connection'|translate }}
                <strong>{{ 'error.retry'|translate }}.</strong>
            </p>
        </div>
        <div ng-if="eventCtrl.status.isLoading" class="big-message absolute">
            <i class="icon-download"></i>
            {{ 'loading' | translate }}
        </div>
        <div ng-if="!eventCtrl.status.isLoading" class="overthrow table-view-images">
            <div ng-repeat="day in eventCtrl.events[eventCtrl.filter.type]">
                <p class="table-view-separator" ng-class="{ 'compress': $index === 0 }">
                    <span ng-switch on="eventCtrl.filter.type">
                        <span ng-switch-when="exhibition">
                            <i class="icon-right"></i> {{ day.date | amDateFormat:'L' }}
                        </span>
                        <span ng-switch-default>
                            {{ day.date | amDateFormat:'dddd, L' }}
                        </span>
                    </span>
                </p>
                <div ng-repeat="event in day.events">
                    <hr ng-hide="$index === 0"/>
                    <div class="row collapse"
                        ng-click="navigation.pushView('event.show', { 'event': event })">
                        <div class="large-1 small-1 columns">
                            <div class="thumbnail color-{{ $index % 5 }}" ng-style="{ 'background-image': 'url('+ event.getThumbnailImage() +')' }" ng-class="{ 'featured': event.isFeatured }"><img src="images/dot.png" /></div>
                        </div>
                        <div class="large-3 small-3 columns main-td">
                            <i class="icon-right-open"></i>
                            <h4 class="title">{{ event.name }}</h4>
                            <p>
                                <strong ng-if="event.countSubEvents() > 0" class="color-text">
                                    <i class="icon-layout color-blue"></i>
                                    {{ event.countSubEvents() }}
                                    {{ 'event.count' | translate }}
                                    <br/>
                                </strong>
                                <span ng-if="event.place">
                                    <i class="icon-location"></i>
                                    {{ event.place.name }}
                                    <br/>
                                </span>
                                <span ng-switch="event.targetAge.code" class="lowercase">
                                    <span ng-switch-when="children">
                                        <i class="icon-school"></i>
                                        <strong>{{ 'event.targetAge.children' | translate }}</strong>, {{ event.getCategoryNames().join(', ') }}
                                    </span>
                                    <span ng-switch-when="adult">
                                        <i class="icon-attention-alt"></i>
                                        <strong>{{ 'event.targetAge.adult' | translate }}</strong>, {{ event.getCategoryNames().join(', ') }}
                                    </span>
                                    <span ng-switch-default>
                                        <i class="icon-tag"></i>
                                        {{ event.getCategoryNames().join(', ') }}
                                    </span>
                                </span>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Filter -->
        <div ng-show="eventCtrl.filter.show" class="filter-container">
            <div ng-click="eventCtrl.closeFilters()" class="capture-click"></div>
            <div class="filter-box">
                <ul>
                    <li ng-repeat="type in ['exhibition','other']"
                        ng-class="{ 'on': type == eventCtrl.filter.type }"
                        ng-click="eventCtrl.setFilter(type)">
                        <i class="icon-ok"></i>
                        {{ ('event.filter.type.'+ type) | translate }}
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div ng-include="view2"></div>
    <div ng-include="view3"></div>
    <div ng-include="view4"></div>
</section>

<script type="text/ng-template" id="event.show">
    <div ng-controller="EventViewController as eviewCtrl">
        <header>
            <a href ng-click="navigation.popView()"><i class="left icon-left"></i></a>
            <h1 class="title">{{ eviewCtrl.event.name }}</h1>
        </header>
        <div class="overthrow">
            <div class="post">
                <div ng-if="eviewCtrl.event.image" class="banner" ng-style="{ 'background-image': 'url('+ eviewCtrl.event.getImage('medium') +')' }"></div>
                <h1 class="title">
                    {{ eviewCtrl.event.name }}
                </h1>
                {{ eviewCtrl.event.description }}
                <div ng-switch="eviewCtrl.event.subEvents.length">
                    <ul ng-switch-when="0" class="cta-list">
                        <li ng-if="eviewCtrl.event.targetAge.code === 'adult'">
                            <i class="icon-attention-alt color-alert"></i>
                            <strong>{{ 'event.targetAge.adult' | translate }}</strong>
                        </li>
                        <li ng-if="eviewCtrl.event.targetAge.code === 'children'">
                            <i class="icon-school"></i>
                            <strong>{{ 'event.targetAge.children' | translate }}</strong>
                        </li>
                        <li ng-if="eviewCtrl.event.place"
                            ng-click="navigation.pushView('views/placeView.html', { id: eviewCtrl.event.place.id, name: eviewCtrl.event.place.name })">
                            <i class="right icon-right-open"></i>
                            <i class="icon-location-alt"></i>
                            {{ eviewCtrl.event.place.name }}<br/>
                            <span class="distance" ng-if="eviewCtrl.geolocation.available">
                                ({{ eviewCtrl.event.place.location.distanceTo(plistCtrl.geolocation) | distance }})
                            </span>
                        </li>
                        <li ng-if="eviewCtrl.event.startAt && eviewCtrl.event.category.code !== 'exhibition'">
                            <i class="icon-calendar-alt"></i>
                            {{ eviewCtrl.event.startAt | amDateFormat:'dddd, ll' }}
                        </li>
                        <li ng-if="eviewCtrl.event.endAt && eviewCtrl.event.category.code === 'exhibition'">
                            <i class="icon-right"></i>
                            {{ eviewCtrl.event.endAt | amDateFormat:'dddd, ll' }}
                        </li>
                        <li ng-if="eviewCtrl.event.timeIsSet('startAt') && eviewCtrl.event.category.code !== 'exhibition' && eviewCtrl.event.subEvents.length === 0">
                            <i class="icon-clock"></i>
                            {{ eviewCtrl.event.startAt | amDateFormat:'HH:mm' }}
                        </li>
                        <li ng-if="eviewCtrl.event.price !== 0">
                            <i class="icon-euro"></i>
                            {{ eviewCtrl.event.price }}
                        </li>
                        <li ng-if="eviewCtrl.event.url"
                            ng-click="navigation.openExternalLink(eviewCtrl.event.url)">
                            <i class="icon-link-external"></i>
                            {{ eviewCtrl.event.url }}
                        </li>
                    </ul>
                    <div ng-switch-default>
                        <div ng-repeat="day in eviewCtrl.event.subEvents">
                            <p class="table-view-separator">
                                {{ day.date | amDateFormat:'dddd, ll' }}
                            </p>
                            <ul class="sub-events-list">
                                <li ng-repeat="event in day.events"
                                    ng-click="navigation.pushView('event.show', { event: event })">
                                    <i class="right icon-right-open"></i>
                                    <i class="icon-clock"></i> <strong>{{ event.startAt | amDateFormat:'HH:mm' }}</strong>, {{ event.name }}<br/>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>
