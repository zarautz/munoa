<section class="on-{{ navigation.activeView }}">
    <div ng-controller="PlacesController as placesCtrl">
        <header>
            <i ng-click="navigation.toggleMenu()" class="left icon-menu"></i>
            <h1 class="title">{{ placesCtrl.section|translate }}</h1>
        </header>
        <div class="overthrow">
            <ul class="small-block-grid-3 large-block-grid-4 block-grid-icons">
                <li ng-repeat="group in placesCtrl.groups"
                    ng-click="navigation.pushView('place.list', { section: placesCtrl.section, group: group.name })">
                    <i class="{{ group.icon }} color-{{ $index % 5 }}"></i>
                    <p class="color-{{ $index % 5 }}">
                        {{ ('placesGroup.'+ placesCtrl.section +'.'+ group.name)|translate }}
                    </p>
                </li>
            </ul>
        </div>
    </div>
    <div ng-include="view2"></div>
    <div ng-include="view3"></div>
</section>

<script type="text/ng-template" id="place.list">
    <div ng-controller="PlaceListController as plistCtrl">
        <header>
            <a href ng-click="navigation.popView()"><i class="left icon-left"></i></a>
            <div ng-switch on="plistCtrl.status.isLoading">
                <div ng-switch-when="true">
                    <i class="right icon-spin color-blue animate-spin"></i>
                </div>
                <div ng-switch-default>
                    <i ng-click="plistCtrl.toggleFilters()" class="right" ng-class="{ 'icon-search': !plistCtrl.isFiltered(), 'icon-filter color-blue': plistCtrl.isFiltered() }"></i>
                </div>
            </div>
            <h1 class="title">{{ ('placesGroup.'+ plistCtrl.section +'.'+ plistCtrl.group)|translate }}</h1>
        </header>

        <!-- Status messages -->
        <div ng-if="plistCtrl.status.isDone && plistCtrl.status.isError" class="error">
            <p ng-click="plistCtrl.refresh()">
                {{ 'error.connection'|translate }}
                <strong>{{ 'error.retry'|translate }} <i class="icon-spin"></i></strong>
            </p>
        </div>
        <div ng-if="plistCtrl.status.isLoading" class="big-message absolute">
            <i class="icon-download"></i>
            {{ 'loading' | translate }}
        </div>

        <!-- Main contents -->
        <div ng-if="!plistCtrl.status.isLoading" class="overthrow">
            <div class="table-view-images">
                <div class="sort-options">
                    <i ng-show="plistCtrl.isFiltered() || plistCtrl.filter.favorite !== null" class="icon-filter"></i>
                    {{ plistCtrl.pager.getTotalItems() }} {{ 'list.results'|translate }}
                    {{ '/ ' + plistCtrl.totalItems }}
                    <i class="right bicon icon-star" ng-class="{ 'fav-on': plistCtrl.filter.favorite !== null }" ng-click="plistCtrl.setFilter('favorite', true)"></i>
                    <i ng-if="plistCtrl.geolocation.available" ng-class="{ 'on': plistCtrl.sorting.type == 'name'}" ng-click="plistCtrl.setSorting('name')" class="right bicon icon-sort-alphabet"></i>
                    <i ng-if="plistCtrl.geolocation.available" ng-class="{ 'on': plistCtrl.sorting.type == 'distance'}" ng-click="plistCtrl.setSorting('distance')" class="right bicon icon-direction"></i>
                </div>
                <div ng-repeat="place in plistCtrl.pager.getAllItems()">
                    <hr />
                    <div class="row collapse"
                        ng-click="navigation.pushView('views/placeView.html', { id: place.id, name: place.name, plistCtrl: plistCtrl })">
                        <div class="large-1 small-1 columns">
                            <div class="thumbnail color-{{ $index % 5 }}" ng-style="{ 'background-image': 'url('+ place.getThumbnailImage() +')' }"><img src="images/dot.png" /></div>
                        </div>
                        <div class="large-3 small-3 columns">
                            <i class="icon-right-open"></i>
                            <h4 class="title">{{ place.name }} <i class="icon-star color-yellow" ng-show="plistCtrl.favorite.isFavorite(place.id)"></i></h4>
                            <p>
                                <i class="icon-location"></i>
                                {{ place.address }}
                                <span class="distance" ng-if="plistCtrl.geolocation.available">
                                    ({{ place.location.distanceTo(plistCtrl.geolocation) | distance }})
                                </span><br/>
                                <i class="icon-tag"></i>
                                {{ place.getTypeNamesExcept(['murkil']).join(', ') }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div ng-if="plistCtrl.pager.getTotalItems() === 0 && plistCtrl.filter.favorite === null" class="big-message">
                <i class="icon-emo-sleep"></i>
                {{ 'list.no_results' | translate }}
            </div>

            <div ng-if="plistCtrl.pager.getTotalItems() === 0 && plistCtrl.filter.favorite !== null" class="big-message">
                <i class="icon-star-empty"></i>
                {{ 'list.no_favorites' | translate }}
            </div>
        </div>
        
        <!-- Filter -->
        <div ng-show="plistCtrl.filter.show" class="filter-container">
            <div ng-click="plistCtrl.closeFilters()" class="capture-click"></div>
            <div class="filter-box">
                <div>
                    <h5 class="section-title">
                        {{ 'filter.name' | translate }}
                        <i class="icon-cancel"
                            ng-show="plistCtrl.filter.name !== null"
                            ng-click="plistCtrl.setFilter('name', null)"></i>
                    </h5>
                    <input ng-model="plistCtrl.filter.name" ng-change="plistCtrl.setFilter('name', plistCtrl.filter.name)" placeholder="{{ 'filter.search' | translate }}" />
                </div>
                <div ng-show="plistCtrl.groupObj.showPriceFilter">
                    <h5 class="section-title">
                        {{ 'filter.price' | translate }}
                        <i class="icon-cancel"
                            ng-show="plistCtrl.filter.price !== null"
                            ng-click="plistCtrl.setFilter('price', null)"></i>
                    </h5>
                    <ul>
                        <li ng-repeat="price in plistCtrl.prices"
                            ng-class="{ 'on': price == plistCtrl.filter.price }"
                            ng-click="plistCtrl.setFilter('price', price)">
                            <i class="icon-ok"></i>
                            {{ price }}
                        </li>
                    </ul>
                </div>
                <div ng-if="plistCtrl.types.length > 1">
                    <h5 class="section-title">
                        {{ 'filter.type' | translate }}
                        <i class="icon-cancel"
                            ng-show="plistCtrl.filter.type !== null"
                            ng-click="plistCtrl.setFilter('type', null)"></i>
                    </h5>
                    <ul>
                        <li ng-repeat="type in plistCtrl.types"
                            ng-class="{ 'on': type == plistCtrl.filter.type }"
                            ng-click="plistCtrl.setFilter('type', type)">
                            <i class="icon-ok"></i>
                            {{ plistCtrl.typesI18N[type] }}
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</script>
